<!DOCTYPE html>
<html lang="en-us">
<head>
    

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177198277-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-177198277-1');
    </script>


    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="toeb&#39;s Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://toeb.github.io//images/carbon.png">
    <meta property="twitter:image" content="https://toeb.github.io//images/carbon.png" />
    

    
    <meta name="title" content="cmakepp: Reading and Writing JSON" />
    <meta property="og:title" content="cmakepp: Reading and Writing JSON" />
    <meta property="twitter:title" content="cmakepp: Reading and Writing JSON" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="thetoeb, toeb, blog, programming">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>cmakepp: Reading and Writing JSON-Toeb Blog</title>

    <link rel="canonical" href="/post/cmakereadingandwritingjson/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">
    
    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">toeb&#39;s Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/cmake">cmake</a>
                        </li>
                        
                        <li>
                            <a href="/categories/compiler">compiler</a>
                        </li>
                        
                        <li>
                            <a href="/categories/programming">programming</a>
                        </li>
                        
                        <li>
                            <a href="/categories/script">script</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/images/carbon.png')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                    </div>
                    <h1>cmakepp: Reading and Writing JSON</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                                toeb&#39;s Blog
                         
                        on 
                        Tuesday, August 30, 2016
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                post-container">

                
                <p>Reading and Writing JSON with CMake
by thetoeb • 2014/03/05 • 2 Comments</p>
<p>While working on a package manager for CMake I came across the problem of finding a suitable format for my package descriptor files. First I thought about and tried using plain old CMake file that simply sets variables and can be included to access its contents. It was very quick and easy to implement. Hierarchical data structures however where hard to implement and a none standard format makes it harder to exchange data with a webservice/other programs. So I opted for using JSON as my import/export format. JSON is alot easier to parse than XML and is still ubiquitous in software developement so I cast aside XML (for now).</p>
<p>You can grab my implementation for reading and writing JSON with CMake at Github. Its part of my object oriented CMake library and uses my implementation for CMake maps and references.</p>
<p>Note: Because CMake only understands strings the deserializer only accepts string , array or object values. Also all keys and values have to be double quoted.</p>
<p>As always: feedback is most welcome if you feel like it you can tell me if you find it usefull, have ideas, or think that I have reinvented the wheel.</p>
<p>Here are some examples for serialization and deserialization:</p>
<h1 id="serialize-empty-value">serialize empty value</h1>
<p>json_serialize(res &ldquo;&quot;)
assert(NOT res)</p>
<h1 id="serialze-simple-value">serialze simple value</h1>
<p>json_serialize(res &ldquo;hello!&quot;)
assert(res)
assert(&quot;&quot;hello!&quot;&rdquo; STREQUAL ${res})</p>
<h1 id="serialize-a-cmake-list-value">serialize a cmake list value</h1>
<p>json_serialize(res &ldquo;a;b;c&rdquo;)
assert(res)
assert(EQUALS &ldquo;&quot;a\\;b\\;c&quot;&rdquo; ${res})</p>
<p>#empty object
element(uut MAP)
element(END)
json_serialize(res ${uut})
assert(&quot;{}&rdquo; STREQUAL ${res})</p>
<h1 id="empty-list">empty list</h1>
<p>element(uut LIST)
element(END)
json_serialize(res ${uut})
assert(&quot;[]&quot; STREQUAL ${res})</p>
<h1 id="ref">ref</h1>
<p>ref_new(uut)
ref_set(${uut} &ldquo;a b c&rdquo;)
json_serialize(res ${uut})
assert(&quot;&quot;a b c&quot;&quot; STREQUAL ${res})</p>
<h1 id="list-with-one-element">list with one element</h1>
<p>element(uut LIST)
value(1)
element(END)
json_serialize(res ${uut})
assert(&quot;[&quot;1&quot;]&quot; STREQUAL ${res})</p>
<h1 id="list-with-multiple-elements-element">list with multiple elements element</h1>
<p>element(uut LIST)
value(1)
value(2)
element(END)
json_serialize(res ${uut})
assert(&quot;[&quot;1&quot;,&quot;2&quot;]&quot; STREQUAL ${res})</p>
<h1 id="object-with-single-value">object with single value</h1>
<p>element(uut MAP)
value(KEY k1 val1)
element(END)
json_serialize(res ${uut})
assert(&quot;{&quot;k1&quot;:&quot;val1&quot;}&quot; STREQUAL ${res})</p>
<h1 id="object-with-multiple-value">object with multiple value</h1>
<p>element(uut MAP)
value(KEY k1 val1)
value(KEY k2 val2)
element(END)
json_serialize(res ${uut})
assert(&quot;{&quot;k1&quot;:&quot;val1&quot;,&quot;k2&quot;:&quot;val2&quot;}&quot; STREQUAL ${res})</p>
<h1 id="list-with-single-map">list with single map</h1>
<p>element(uut LIST)
element()
value(KEY k1 1)
element(END)
element(END)
json_serialize(res ${uut})
assert(&quot;[{&quot;k1&quot;:&quot;1&quot;}]&quot; STREQUAL ${res})</p>
<h1 id="deserialize-a-empty-value">deserialize a empty value</h1>
<p>json_deserialize(res &ldquo;&quot;)
assert(NOT res)</p>
<h1 id="deserialize-a-empty-object">deserialize a empty object</h1>
<p>json_deserialize(res &ldquo;{}&quot;)
assert(res)
ref_isvalid( ${res}  is_ref)
assert(is_ref MESSAGE &ldquo;expected res to be a ref&rdquo;)</p>
<h1 id="desirialize-a-empty-array">desirialize a empty array</h1>
<p>json_deserialize(res &ldquo;[]&quot;)
assert(res)
ref_isvalid( ${res} is_ref)
assert(is_ref MESSAGE &ldquo;expected res to be a ref&rdquo;)</p>
<h1 id="deserialize-a-simple-value">deserialize a simple value</h1>
<p>json_deserialize(res &ldquo;&quot;teststring&quot;&quot;)
assert(${res} STREQUAL &ldquo;teststring&rdquo;)</p>
<h1 id="deserialize-a-array-with-one-value">deserialize a array with one value</h1>
<p>json_deserialize(res &ldquo;[&quot;1&quot;]&quot;)
map_navigate(val &ldquo;res[0]&quot;)
assert(${val} STREQUAL &ldquo;1&rdquo;)</p>
<p>#deserialize a array with multiple values
json_deserialize(res &ldquo;[&quot;1&quot;, &quot;2&quot;]&quot;)
map_navigate(val &ldquo;res[0]&quot;)
assert(${val} STREQUAL &ldquo;1&rdquo;)
map_navigate(val &ldquo;res[1]&quot;)
assert(${val} STREQUAL &ldquo;2&rdquo;)</p>
<h1 id="deserialize-a-simple-object-with-one-value">deserialize a simple object with one value</h1>
<p>json_deserialize(res &ldquo;{ &quot;key&quot; : &quot;value&quot;}&quot;)
map_navigate(val &ldquo;res.key&rdquo;)
assert(${val} STREQUAL &ldquo;value&rdquo;)</p>
<h1 id="deserialize-a-simple-object-with-multiple-values">deserialize a simple object with multiple values</h1>
<p>json_deserialize(res &ldquo;{ &quot;key&quot; : &quot;value&quot;, &quot;key2&quot; : &quot;val2&quot;}&quot;)
map_navigate(val &ldquo;res.key&rdquo;)
assert(${val} STREQUAL &ldquo;value&rdquo;)
map_navigate(val &ldquo;res.key2&rdquo;)
assert(${val} STREQUAL &ldquo;val2&rdquo;)</p>
<h1 id="deserialize-a-simple-nested-structure">deserialize a simple nested structure</h1>
<p>json_deserialize(res &ldquo;{ &quot;key&quot; : {&quot;key3&quot;:&quot;myvalue&quot; }, &quot;key2&quot; : &quot;val2&quot;}&quot;)
map_navigate(val &ldquo;res.key2&rdquo;)
assert(${val} STREQUAL &ldquo;val2&rdquo;)
map_navigate(val &ldquo;res.key.key3&rdquo;)
assert(${val} STREQUAL &ldquo;myvalue&rdquo;)</p>
<h1 id="deserialize-a-nested-structure-containing-both-arrays-and-objects">deserialize a nested structure containing both arrays and objects</h1>
<p>json_deserialize(res &ldquo;{ &quot;key&quot; : [&quot;1&quot;, &quot;2&quot;], &quot;key2&quot; : &quot;val2&quot;}&quot;)
map_navigate(val &ldquo;res.key2&rdquo;)
assert(${val} STREQUAL &ldquo;val2&rdquo;)
map_navigate(val &ldquo;res.key[0]&quot;)
assert(${val} STREQUAL &ldquo;1&rdquo;)
map_navigate(val &ldquo;res.key[1]&quot;)
assert(${val} STREQUAL &ldquo;2&rdquo;)</p>
<h1 id="deserialize-a-deeply-nested-structure-and-get-a-value">deserialize a &lsquo;deeply&rsquo; nested structure and get a value</h1>
<p>json_deserialize(res &ldquo;{ &quot;key&quot; : [{&quot;k1&quot;:&quot;v1&quot;}, &quot;2&quot;], &quot;key2&quot; : &quot;val2&quot;}&quot;)
map_navigate(val &ldquo;res.key[0].k1&rdquo;)
assert(${val} STREQUAL &ldquo;v1&rdquo;)</p>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/cmakeppreflectingandmanipulatingcmakelists/" data-toggle="tooltip" data-placement="top" title="cmakepp: reflecting and manipulating CMakeLists">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/cppdynamicobject/" data-toggle="tooltip" data-placement="top" title="An Implementation of the Dynamic Object in C&#43;&#43;">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



<script src="https://utteranc.es/client.js"
repo="toeb/devblog"
issue-term="pathname"
label="comment"
theme="github-light"
crossorigin="anonymous"
async>
</script>





            </div>
            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="toeb&#39;s Blog" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:redacted@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/toeb">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/tobias-becker-a64475a3/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a target="_blank" href="https://stackoverflow.com/users/1229468/toeb">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    <li>
                        <a target="_blank" href="https://www.reddit.com/user/toebi">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-reddit fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    
            
            
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; toeb&#39;s Blog 2021
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
