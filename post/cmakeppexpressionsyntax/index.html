<!DOCTYPE html>
<html lang="en-us">
<head>
    

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177198277-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-177198277-1');
    </script>


    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="toeb&#39;s Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://toeb.github.io//images/carbon.png">
    <meta property="twitter:image" content="https://toeb.github.io//images/carbon.png" />
    

    
    <meta name="title" content="cmakepp: Expression Syntax" />
    <meta property="og:title" content="cmakepp: Expression Syntax" />
    <meta property="twitter:title" content="cmakepp: Expression Syntax" />
    

    
    <meta name="description" content="descr">
    <meta property="og:description" content="descr" />
    <meta property="twitter:description" content="descr" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="thetoeb, toeb, blog, programming">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>cmakepp: Expression Syntax-Toeb Blog</title>

    <link rel="canonical" href="/post/cmakeppexpressionsyntax/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">
    
    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">toeb&#39;s Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/tech">tech</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/images/carbon.png')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/tag1" title="tag1">
                            tag1
                        </a>
                        
                        <a class="tag" href="/tags/tag2" title="tag2">
                            tag2
                        </a>
                        
                    </div>
                    <h1>cmakepp: Expression Syntax</h1>
                    <h2 class="subheading">subtlt</h2>
                    <span class="meta">
                        Posted by 
                        
                                 &#34;&#34;
                         
                        on 
                        Monday, June 4, 2018
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                post-container">

                
                <p>“CMake’s syntax is not sexy.” Is a statement that probably everyone can understand. It does not allow the developer rudimentary constructs which almost all other languages have. But because CMake’s language is astonishingly flexible I was able to create a lexer and parser and interpreter for a custom 100 % compatible syntax which (once “JIT transpiled”) is also fast. I call it cmakepp expressions or expr for short. I want to emphasize that all of this is written in 100% compatible cmake code and you can use it without the need to preprocess any cmake files or adding any dependencies (except cmakepp).</p>
<p>You can get access to my project at <a href="https://github.com/toeb/cmakepp">https://github.com/toeb/cmakepp</a>. I greatly appreciate new users, likes and feedback. If you want you can even help make cmakepp better by submitting issues or pull requests. The largest discussions to my posts is always on reddit.</p>
<p>Example
The easiest way to introduce the new expr syntax and its usefulness is by example. So here it is (Note that these example are actually executed during the generation of this document using my cmake template engine (link) so the result displayed is actually computed).</p>
<p>You can run these examples yourself – just look at the getting cmakepp section in cmakepp‘s documentation. (Which boils down to downloading a single file and including it)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake"><span style="color:#75715e">## results of the evaluation are printed as normal strings or 
</span><span style="color:#75715e">## as json if the result contains an object (complex data)
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># values
</span><span style="color:#75715e">## number
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">1</span>) <span style="color:#75715e"># =&gt; `1` 
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## bool
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">true</span>) <span style="color:#75715e"># =&gt; `true`
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">false</span>) <span style="color:#75715e"># =&gt; `false`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## null
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">null</span>) <span style="color:#75715e"># =&gt; ``
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## single quoted string
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">&#34;&#39;hello world&#39;&#34;</span>) <span style="color:#75715e"># =&gt; `hello world` 
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">&#34;&#39;null&#39;&#34;</span>) <span style="color:#75715e"># =&gt; `null` 
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## double quoted string
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">&#34;\&#34;</span><span style="color:#e6db74">hello</span> <span style="color:#e6db74">world\</span><span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#75715e"># =&gt; `hello world`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## separated string (a string which is a single argument)
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">&#34;hello world&#34;</span>) <span style="color:#75715e"># =&gt; `hello world` 
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## unquoted
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">hello</span>)  <span style="color:#75715e"># =&gt; `hello`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## list
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">[1,2,3]</span>)  <span style="color:#75715e"># =&gt; `1;2;3`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## object 
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">{first_name:Tobias,</span> <span style="color:#e6db74">&#39;last_name&#39;:</span> <span style="color:#e6db74">&#34;Becker&#34;</span> <span style="color:#e6db74">}</span>)  <span style="color:#75715e"># =&gt; {&#34;first_name&#34;:&#34;Tobias&#34;,&#34;last_name&#34;:&#34;Becker&#34;}
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## complex value
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">{value:[1,{a:2,b:{c:[3,4,5],d:2}},{}]}</span>)  <span style="color:#75715e"># =&gt; {&#34;value&#34;:[1,{&#34;a&#34;:2,&#34;b&#34;:{&#34;c&#34;:[3,4,5],&#34;d&#34;:2}},{}]}
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## concatenation 
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">hello</span> <span style="color:#e6db74">world</span> <span style="color:#e6db74">1</span> <span style="color:#e6db74">null</span> <span style="color:#e6db74">2</span> <span style="color:#e6db74">&#39;null&#39;</span> <span style="color:#e6db74">3</span>) <span style="color:#75715e"># =&gt; `helloworld12null3`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># scope variables
</span><span style="color:#75715e">## variable
</span><span style="color:#75715e"></span>set(<span style="color:#e6db74">my_var</span> <span style="color:#e6db74">&#34;hello world&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>expr(<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#e6db74">my_var</span>) <span style="color:#75715e"># =&gt; `hello world`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## variable scope variable 
</span><span style="color:#75715e"></span>set(<span style="color:#e6db74">my_var</span> <span style="color:#e6db74">&#34;hello world&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">var_name</span> <span style="color:#e6db74">my_var</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>expr(<span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#e6db74">var_name</span>))  <span style="color:#75715e"># =&gt; `hello world`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## assign scope variable
</span><span style="color:#75715e"></span>expr(<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#e6db74">a</span> <span style="color:#e6db74">=</span> <span style="color:#e6db74">1</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>assert(<span style="color:#e6db74">&#34;${a}&#34;</span> <span style="color:#e6db74">EQUAL</span> <span style="color:#e6db74">1</span>)  <span style="color:#75715e"># =&gt; `1`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># function
</span><span style="color:#75715e">## test function
</span><span style="color:#75715e"></span>function(<span style="color:#e6db74">my_add</span> <span style="color:#e6db74">lhs</span> <span style="color:#e6db74">rhs</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    math(<span style="color:#e6db74">EXPR</span> <span style="color:#e6db74">sum</span> <span style="color:#e6db74">&#34;${lhs} + ${rhs}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    return(<span style="color:#e6db74">&#34;${sum}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>endfunction()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## call normal cmake function
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">my_add(1,2</span>)<span style="color:#960050;background-color:#1e0010">)</span>  <span style="color:#75715e"># =&gt; `3`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## use function invocation as argument (`f(g(x))`)
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">my_add(my_add(my_add(1,2</span>)<span style="color:#960050;background-color:#1e0010">,3),4))</span> <span style="color:#75715e"># =&gt; `10`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## use bind call which inserts the left hand value into a function as the first parameter 
</span><span style="color:#75715e"></span>expr(<span style="color:#e6db74">&#34;hello there this is my new title&#34;</span><span style="color:#e6db74">::string_to_title(</span>)<span style="color:#960050;background-color:#1e0010">)</span> <span style="color:#75715e"># =&gt; `Hello There This Is My New Title`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## **enabling cmakepp expressions for the current function or file scope**
</span><span style="color:#75715e">## All expressions before the call to `cmakepp_enable_expressions` are not 
</span><span style="color:#75715e">## evaluated as expressions.  All code after the call to 
</span><span style="color:#75715e">## `cmakepp_enable_expressions` is evaluated.  (also sub functions, but not includes)
</span><span style="color:#75715e">## This is a very hacky approach beacuse it works by parsing 
</span><span style="color:#75715e">## the and transpiling current file. It works in standard cases. In complex 
</span><span style="color:#75715e">## cases I suggest you rather define a new function which uses 
</span><span style="color:#75715e">## the `arguments_expression` macro which is more consistent in behaviour. 
</span><span style="color:#75715e">## Please consult the documentation of `cmakepp_enable_expressions` before 
</span><span style="color:#75715e">## using it. 
</span><span style="color:#75715e"></span>function(<span style="color:#e6db74">my_test_function</span>) <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">## here expressions ARE NOT evaluated yet
</span><span style="color:#75715e"></span>    set(<span style="color:#e6db74">result</span> <span style="color:#e6db74">&#34;unevaluated $[hello world]&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">## this call causes cmakepp expressions to be evaluated for
</span><span style="color:#75715e"></span>    <span style="color:#75715e">## the rest of the current function body
</span><span style="color:#75715e"></span>    cmakepp_enable_expressions(<span style="color:#f92672">${</span>CMAKE_CURRENT_LIST_LINE<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">## here expressions ARE being evaluated
</span><span style="color:#75715e"></span>    set(<span style="color:#e6db74">result</span> <span style="color:#e6db74">&#34;${result} evaluated: $[hello world]&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    return(<span style="color:#f92672">${</span>result<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>endfunction()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>my_test_function() <span style="color:#75715e"># =&gt; `unevaluated $[hello world] evaluated: helloworld`
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## defining a cmake function which parses it parameters using `expr`
</span><span style="color:#75715e">## This a replacement for `cmake_parse_arguments` which is more mighty and
</span><span style="color:#75715e">## also very easy to use
</span><span style="color:#75715e">## 
</span><span style="color:#75715e"></span>function(<span style="color:#e6db74">my_other_test_function</span>) <span style="color:#75715e">## note: no arguments defined
</span><span style="color:#75715e"></span>    <span style="color:#75715e">## 0 ${ARGC} specify the range of arguments of `my_other_test_function`
</span><span style="color:#75715e"></span>    <span style="color:#75715e">## which are to be parsed.  The normal case is `0 ${ARGC}` however you can
</span><span style="color:#75715e"></span>    <span style="color:#75715e">## also choose to mix cmake argument handling and expression arguments
</span><span style="color:#75715e"></span>    <span style="color:#75715e">## here you can also specify arguments which are extracted
</span><span style="color:#75715e"></span>    arguments_expression(<span style="color:#e6db74">0</span> <span style="color:#f92672">${</span>ARGC<span style="color:#f92672">}</span> <span style="color:#e6db74">var_1</span> <span style="color:#e6db74">var_2</span> <span style="color:#e6db74">var_3</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">## all arguments which are left unparsed are returned in encoded list 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">## format and need to be `encoded_list_decode`&#39;d before they can be used
</span><span style="color:#75715e"></span>    ans(<span style="color:#e6db74">unused_arguments</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">result</span>  <span style="color:#e6db74">&#34;result of arguments_expression macro: \n&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">counter</span> <span style="color:#e6db74">0</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    foreach(<span style="color:#e6db74">unused_arg</span> <span style="color:#f92672">${</span>unused_arguments<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        math(<span style="color:#e6db74">EXPR</span> <span style="color:#e6db74">counter</span> <span style="color:#e6db74">&#34;${counter} + 1&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        encoded_list_decode(<span style="color:#e6db74">&#34;${unused_arg}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        ans(<span style="color:#e6db74">decoded_unused_arg</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        set(<span style="color:#e6db74">result</span> <span style="color:#e6db74">&#34;${result}unused_arg[${counter}]: &#39;${decoded_unused_arg}&#39;\n&#34;</span>)        <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    endforeach()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">## defined arguments are available as scope variables
</span><span style="color:#75715e"></span>    set(<span style="color:#e6db74">result</span> <span style="color:#e6db74">&#34;${result}var_1: ${var_1}\n&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">result</span> <span style="color:#e6db74">&#34;${result}var_2: ${var_2}\n&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">result</span> <span style="color:#e6db74">&#34;${result}var_3: ${var_3}\n&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">## named arguments which are not defined are not 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">## imported into the functions scope. They are still 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">## accessible through `arguments_expression_result` (a map)
</span><span style="color:#75715e"></span>    format(<span style="color:#e6db74">&#34;var_4: {arguments_expression_result.var_4}\nvar_5:{arguments_expression_result.var_5}\n&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ans(<span style="color:#e6db74">formatted</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">result</span> <span style="color:#e6db74">&#34;${result}${formatted}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">## return the string
</span><span style="color:#75715e"></span>    return_ref(<span style="color:#e6db74">result</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>endfunction()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## Explanation of function call:
</span><span style="color:#75715e">## the first argument `[a,eval_math(&#39;3*5&#39;),c]` is treated as a single list and 
</span><span style="color:#75715e">## put into `var_1`.  
</span><span style="color:#75715e">## the second argument is spread out (because of ellipsis `...` operation)
</span><span style="color:#75715e">## and therfore only the first value lands in `var_3` 
</span><span style="color:#75715e">## named vars have a higher precedence than positional vars therefore `var_2` 
</span><span style="color:#75715e">## contains `hello world`
</span><span style="color:#75715e">## unused named vars are ignored but can be still be accessed using the
</span><span style="color:#75715e">## `arguments_expression_result` variable which is automatically defined 
</span><span style="color:#75715e">## after calling the `arguments_expression` macro
</span><span style="color:#75715e">## please note that commas are important
</span><span style="color:#75715e"></span>my_other_test_function(
    <span style="color:#e6db74">[a,eval_math(&#39;3*5&#39;</span>)<span style="color:#960050;background-color:#1e0010">,c],
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#960050;background-color:#1e0010">[d,e]...,
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#960050;background-color:#1e0010">var_2:</span> <span style="color:#960050;background-color:#1e0010">&#34;hello</span> <span style="color:#960050;background-color:#1e0010">world&#34;</span> <span style="color:#960050;background-color:#1e0010">,
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#960050;background-color:#1e0010">f,[g,h],
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#960050;background-color:#1e0010">var_4:</span> <span style="color:#960050;background-color:#1e0010">&#34;another</span> <span style="color:#960050;background-color:#1e0010">value&#34;
</span><span style="color:#960050;background-color:#1e0010">)</span>  <span style="color:#75715e"># =&gt; `result of arguments_expression macro: 
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">unused_arg[1]:</span> <span style="color:#960050;background-color:#1e0010">&#39;e&#39;
</span><span style="color:#960050;background-color:#1e0010">unused_arg[2]:</span> <span style="color:#960050;background-color:#1e0010">&#39;f&#39;
</span><span style="color:#960050;background-color:#1e0010">unused_arg[3]:</span> <span style="color:#960050;background-color:#1e0010">&#39;g;h&#39;
</span><span style="color:#960050;background-color:#1e0010">var_1:</span> <span style="color:#960050;background-color:#1e0010">a;15;c
</span><span style="color:#960050;background-color:#1e0010">var_2:</span> <span style="color:#960050;background-color:#1e0010">hello</span> <span style="color:#960050;background-color:#1e0010">world
</span><span style="color:#960050;background-color:#1e0010">var_3:</span> <span style="color:#960050;background-color:#1e0010">d
</span><span style="color:#960050;background-color:#1e0010">var_4:</span> <span style="color:#960050;background-color:#1e0010">another</span> <span style="color:#960050;background-color:#1e0010">value
</span><span style="color:#960050;background-color:#1e0010">var_5:
</span><span style="color:#960050;background-color:#1e0010">`
</span></code></pre></div><p>##Functions and Datatypes
I provide the following functions for you to interact with expr.</p>
<p>expr
arguments_expression
cmakepp_enable_expressions
expr
(<expression>)-&gt;<any></p>
<p>parses, compiles and evaluates the specified expression. The compilation result is cached (per cmake run)</p>
<p>arguments_expression
(<begin index> <end index> <parameter definition>&hellip;)-&gt;<any>&hellip;</p>
<p>parses the arguments of the calling function cmakepp expressions expects begin index to be the index of first function parameters (commonly 0) and end index to be the index of the last function parameter to parse (commonly ${ARGC}) var args are named arguments which will be set to be available in the function scope</p>
<p>named arguments passed to function have a higher precedence than positional arguments</p>
<p>sideffects: * arguments_expression_result is a address of an object containing all parsed data * scope operations may modify the parent scope of the function</p>
<p>cmakepp_enable_expressions
(${CMAKE_CURRENT_LIST_LINE})-&gt;<any></p>
<p>you need to pass ${CMAKE_CURRENT_LIST_LINE} for this to work</p>
<p>this macro enables all expressions in the current scope it will only work in a CMake file scioe or inside a cmake function scope. You CANNOT use it in a loop, if statement, macro etc (everything that has a begin/end) Every expression inside that scope (and its subscopes) will be evaluated.</p>
<p>Implementation Note: This is achieved by parsing the while cmake file (and thus potentially takes very long) Afterwards the line which you pass as an argument is used to find the location of this macro every argument for every following expression in the current code scope is scanned for $[&hellip;] brackets which are in turn lexed,parsed and compiled (see expr()) and injected into the code which is in turn included</p>
<p>The Expression Language Definition
I mixed several constructs and concepts from different languages which I like – the syntax should be familiar for someone who knows JavaScript and C++. I am not a professional language designer so some decisions might seem strange however I have tested everything thouroughly and am happy to fix any bugs.</p>
<p>For better or worse here is the language definition which is still a work in progress.</p>
<h2 id="the-forbidden-chars-are-used-by-the-tokenizer-and-using-them-will-cause-the-world-to-explode-they-are-all-valid-ascii-codes--32-and--0">the forbidden chars are used by the tokenizer and using them will cause the world to explode. They are all valid ASCII codes &lt; 32 and &gt; 0</h2>
<p><forbidden char> ::=  SOH | NAK | US | STX | ETX | GS | FS | SO<br>
<escapeable char> :: = &ldquo;&quot; &quot;&rdquo;&quot; &ldquo;'&rdquo;<br>
<free char> ::= <ascii char>  /  <forbidden char> / <escapablechar> 
<escaped char> 
<quoted string content> ::= &laquo;char&gt;|&quot;&quot; <escaped char>&gt;*</p>
<h2 id="strings">strings</h2>
<p><double quoted string> ::= &quot;&quot;&quot; <quoted string content> &quot;&quot;&quot;
expr(&quot;&quot;&quot;&quot;) # =&gt; ``
expr(&quot;&quot;hello&quot;&quot;) # =&gt; <code>hello</code>
expr(&quot;&quot;\' single quote&quot;&quot;) # =&gt; <code>' single quote</code>
expr(&quot;&quot;\&quot; double quote&quot;&quot;) # =&gt; <code>&quot; double quote</code>
expr(&quot;&quot;\ backslash&quot;&quot;) # =&gt; <code>\ backslash</code></p>
<p><single quoted string> ::= &ldquo;'&rdquo; <quoted string content> &ldquo;'&rdquo;
expr(&quot;''&quot;) # =&gt; <code>expr('') # =&gt; </code>
expr(&quot;&lsquo;hello&rsquo;&quot;) # =&gt; <code>hello</code>
expr(&lsquo;hello&rsquo;) # =&gt; <code>hello</code>
expr(&quot;&lsquo;hello world&rsquo;&quot;) # =&gt; <code>hello world</code>
expr(&quot;'\' single quote'&quot;) # =&gt; <code>' single quote</code>
expr(&quot;'\&quot; double quote'&quot;) # =&gt; <code>&quot; double quote</code>
expr(&quot;'\\ backslash'&quot;) # =&gt; <code>\\ backslash</code></p>
<p><unquoted string> ::= 
expr(hello) # =&gt; <code>hello</code></p>
<p><separated string> ::= 
expr(&quot;&quot;) # =&gt; ``
expr(&ldquo;hello world&rdquo;) # =&gt; <code>hello world</code></p>
<p><string> ::= <double quoted string> | <single quoted string> | <unquoted string> | <separated string></p>
<h2 id="every-literal-is-a-const-string">every literal is a const string</h2>
<h2 id="some-unquoted-strings-have-a-special-meaning">some unquoted strings have a special meaning</h2>
<h2 id="quoted-strings-are-always-strings-even-if-their-content-matches-one">quoted strings are always strings even if their content matches one</h2>
<h2 id="of-the-specialized-definitions">of the specialized definitions</h2>
<p><number> ::= /0|[1-9][0-9]*/
number
expr(0) # =&gt; <code>0</code>
expr(1) # =&gt; <code>1</code>
expr(912930) # =&gt; <code>912930</code>
NOT number:
expr(01) # =&gt; <code>01</code>
expr(&lsquo;1&rsquo;) # =&gt; <code>1</code>
expr(&quot;&quot;1&quot;&quot;) # =&gt; <code>1</code></p>
<p><bool> ::= &ldquo;true&rdquo; | &ldquo;false&rdquo;
bool
expr(true) # =&gt; <code>true</code>
expr(false) # =&gt; <code>false</code>
NOT bool
expr(&lsquo;true&rsquo;) # =&gt; <code>true</code>
expr(&quot;false&quot;) # =&gt; <code>false</code></p>
<p><null> ::= &ldquo;null&rdquo;
null
expr(null) # =&gt; ``
NOT null
expr(&lsquo;null&rsquo;) # =&gt; <code>null</code></p>
<p><literal> ::= <string>|<number>|<bool>|<null>
valid literal
expr(&ldquo;hello world&rdquo;) # =&gt; <code>hello world</code>
expr(123) # =&gt; <code>123</code>
expr(&lsquo;123&rsquo;) # =&gt; <code>123</code>
expr(true) # =&gt; <code>true</code>
expr(null) # =&gt; <code>expr(&quot;&quot;) # =&gt; </code>
expr(abc) # =&gt; <code>abc</code></p>
<p><list> ::= &ldquo;[&rdquo; <empty> | (<value> &ldquo;,&quot;)* <value> &ldquo;]&rdquo;
expr(&quot;[1,2,3,4]&quot;) # =&gt; <code>1;2;3;4</code>
expr(&quot;[1]&quot;) # =&gt; <code>1</code>
expr(&quot;[string_to_title(&lsquo;hello world&rsquo;), &lsquo;goodbye world&rsquo;::string_to_title()]&quot;) # =&gt; <code>Hello World;Goodbye World</code></p>
<p><key value> ::= <value>:<value>
<object property> ::= <key value> | <value>
<object> ::= &ldquo;{&rdquo; <empty> | (<object property> &ldquo;,&quot;)* <object property> &ldquo;}&rdquo;
expr({}) # =&gt; {} 
expr({a:b}) # =&gt; {&ldquo;a&rdquo;:&ldquo;b&rdquo;} 
expr({a: (&ldquo;hello world&rdquo;::string_to_title())}) # =&gt; {&ldquo;a&rdquo;:&ldquo;Hello World&rdquo;}</p>
<p><paren> ::= &ldquo;(&rdquo; <value> &ldquo;)&rdquo;</p>
<h2 id="ellipsis-are-treated-differently-in-many-situation">ellipsis are treated differently in many situation</h2>
<h2 id="if-used-in-a-function-parameter-the-arguments-will-be-spread-out">if used in a function parameter the arguments will be spread out</h2>
<h2 id="if-used-in-a-navigation-or-indexation-expression-the-navigation-or">if used in a navigation or indexation expression the navigation or</h2>
<h2 id="indexation-applied-to-every-element-in-value">indexation applied to every element in value</h2>
<p><ellipsis> ::= <value> &ldquo;&hellip;&rdquo;</p>
<h2 id="if-lvalue-is-null-it-is-set-to-the-default-value-a-new-map">if lvalue is <null> it is set to the default value (a new map)</h2>
<p><default value> ::= <lvalue> &ldquo;!&rdquo;</p>
<p><value> ::= <paren> |
| <value dereference>
| <value reference>
| <ellipsis>
| <literal>
| <interpolation>
| <bind call>
| <call>
| <list>
| <object>
| <scope variable>
| <indexation>
| <navigation>
| <paren>
| <default value></p>
<h2 id="a-parameter-can-be-a-value-or-the-returnvalue-operator-">a parameter can be a value or the returnvalue operator &ldquo;$&rdquo;</h2>
<h2 id="if-the-return-value-operator-is-specified-the-output-of-that-parameter">if the return value operator is specified the output of that parameter</h2>
<h2 id="is-treated-as-the-result-of-the-function-call">is treated as the result of the function call</h2>
<h2 id="this-is-usefull-for-using-function-which-do-not-adhere-to-the">this is usefull for using function which do not adhere to the</h2>
<h2 id="return-value-convention-if-used-multiple-times-inside-a-call">return value convention. If used multiple times inside a call</h2>
<h2 id="the-results-are-accumulated">the results are accumulated.</h2>
<p><parameter> ::= <value> | &ldquo;$&rdquo;</p>
<p><parameters> ::= &ldquo;(&rdquo; <empty> | (<parameter> &ldquo;,&rdquo; )* <parameter>  &ldquo;)&rdquo;</p>
<p><normal call> ::= <value> <parameters>
expr(string_to_title(&ldquo;hello world&rdquo;)) # =&gt; <code>Hello World</code> 
expr(&ldquo;eval_math(&lsquo;3 + 4&rsquo;)&quot;) # =&gt; <code>7</code></p>
<h2 id="bind-call-binds-the-left-hand-value-as-the-first-parameter-of-the-function">bind call binds the left hand value as the first parameter of the function</h2>
<p><bind call> ::=  <value> &ldquo;::&rdquo; <value> <parameter><br>
expr(&ldquo;hello world&rdquo;::string_to_title()) # =&gt; <code>Hello World</code></p>
<p><call> ::= <normal call> | <bind call></p>
<p><scope variable> ::= &ldquo;$&rdquo; <literal> 
set(my_var hello!) 
expr($my_var) # =&gt; <code>hello!</code></p>
<p><index> ::= &ldquo;-&rdquo;? <number> | &ldquo;$&rdquo; | &ldquo;n&rdquo;
<increment> ::= &ldquo;-&rdquo;? <number>
<range> ::= <empty> | <index> | <index> &ldquo;:&rdquo; <index> | <index> &ldquo;:&rdquo; <index> : <increment></p>
<p><indexation parameter> ::= <range> | <value>
<indexation parameters> ::= (<indexation parameter> &ldquo;,&quot;)* <indexation parameter>
<indexation> ::= <value>&quot;[&rdquo; <indexation parameters> &ldquo;]&rdquo;
expr(&quot;{a:1,b:2}[&lsquo;a&rsquo;,&lsquo;b&rsquo;]&quot;) # =&gt; <code>1;2</code> 
expr(&quot;[{a:1,b:2},{a:3,b:4}]&hellip;[&lsquo;a&rsquo;,&lsquo;b&rsquo;]&quot;) # =&gt; <code>1;3;2;4</code></p>
<p><lvalue> ::= <scope variable> | <navigation> | <indexation></p>
<p><assign> ::= <lvalue> &ldquo;=&rdquo; <value>
## sets the scope variable my_value to 1
expr($my_value = 1)
expr($my_value) # =&gt; <code>1</code> 
## coerces the scope value my_other_value to be an object
#expr($my_other_value!.a!.b = 123)
#expr($my_other_value) # =&gt; ``</p>
<p><expression> ::= <assign> | <value></p>
<p>Caveats
Syntax
The syntax is not implemented completely yet (missing return value token $). There are some conflicts in operation precedence (which can currently be solved with parenthesis). All Examples described here work however.</p>
<p>Speed
Compiling these expressions is slow: a simple expression compiles in hundreds of milliseconds. Complex expressions can take several seconds. However this is only when they are first encountered. afterwards the speed is fast even if the expressions are complex. Currently I cache the expressions everytime cmake starts. An example is when using arguments_expression(&hellip;) It takes up to 1000ms to compile</p>
<p>my_other_test_function(
[a,eval_math(&lsquo;3*5&rsquo;),c],
[d,e]&hellip;,
var_2: &ldquo;hello world&rdquo; ,
f,[g,h],
var_4: &ldquo;another value&rdquo;
)
however execution time is less than 10 ms</p>
<p>Future Work
Syntax
I still need to implement correct math in the expressions which is a big minus in cmake (anyone who every had to work with negative values knows what I mean). Expressions like (-$a + 33) / -12 should be simple enough to get to work.</p>
<p>The return token $ needs to work. currently I do not support it.</p>
<p>Range based get and set needs to be implemented.</p>
<h1 id="let-a--babbbcbd">let a = [{b:&lsquo;a&rsquo;},{b:&lsquo;b&rsquo;},{b:&lsquo;c&rsquo;},{b:&rsquo;d'}]</h1>
<h1 id="then">then</h1>
<p>$a[1:2].b = [1,2]&hellip;</p>
<h2 id="should-result-in">should result in</h2>
<h1 id="let-a--bab1b2bd">let a = [{b:&lsquo;a&rsquo;},{b:&lsquo;1&rsquo;},{b:&lsquo;2&rsquo;},{b:&rsquo;d'}]</h1>
<p>Speed
I still need to cache expressions between cmake runs which will decrease the time needed by alot (as expressions only need to be reevaluated whenever it changes)</p>
<p>Afterwards
When the syntax is complete and this feature works well the next step is to incorporate it into CMake using C code which will significantly increase the speed. This will make everything much, much faster and might even get rid of those hideous generator expressions.</p>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/csharpfluentexceptionhandling/" data-toggle="tooltip" data-placement="top" title="A Fluent Way of Exception Handling">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="toeb&#39;s Blog" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:redacted@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/toeb">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/tobias-becker-a64475a3/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a target="_blank" href="https://stackoverflow.com/users/1229468/toeb">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    <li>
                        <a target="_blank" href="https://www.reddit.com/user/toebi">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-reddit fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    
            
            
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; toeb&#39;s Blog 2021
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
